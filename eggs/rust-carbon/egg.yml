name: Rust - All Carbon Builds
description: The only aim in Rust is to survive.
author: support@pterodactyl.io
features:
  - steam_disk_space
images:
  - !!var images.rust_game

install:
  script: !!file install.sh
  container: "ghcr.io/pterodactyl/installers:debian"
  entrypoint: "bash"

config:
  stop: "quit"
  startup:
    done: "Server startup complete"

startup: ./RustDedicated -batchmode $( [ "${FRAMEWORK}" == "oxide" ] && echo +oxide.directory {{MODDING_ROOT}} || [ "${FRAMEWORK}" == "vanilla" ] && echo "" || echo -carbon.rootdir {{MODDING_ROOT}} ) +server.port {{SERVER_PORT}} +server.queryport {{QUERY_PORT}} +server.identity \"{{SERVER_IDENTITY}}\" +server.gamemode \"{{GAMEMODE}}\" +rcon.ip 0.0.0.0 +rcon.port {{RCON_PORT}} +rcon.web true +server.hostname \"{{HOSTNAME}}\" +server.level \"{{LEVEL}}\" +server.description \"{{DESCRIPTION}}\" +server.url \"{{SERVER_URL}}\" +server.headerimage \"{{SERVER_IMG}}\" +server.logoimage \"{{SERVER_LOGO}}\" +server.maxplayers {{MAX_PLAYERS}} +rcon.password \"{{RCON_PASS}}\" +server.saveinterval {{SAVEINTERVAL}} +app.port {{APP_PORT}}  $( [ -z ${MAP_URL} ] && printf %s "+server.worldsize \"{{WORLD_SIZE}}\" +server.seed \"{{WORLD_SEED}}\"" || printf %s "+server.levelurl {{MAP_URL}}" ) $( [ -n "{{APP_PUBLIC_IP}}" ] && echo "+app.publicip \"{{APP_PUBLIC_IP}}\"" ) $( [ -n "{{SERVER_TAGS}}" ] && echo "+server.tags \"{{SERVER_TAGS}}\"" ) $( [ -n "{{LOG_FILE}}" ] && echo "-logfile \"{{LOG_FILE}}\"" ) {{ADDITIONAL_ARGS}}

variables:
  - name: Server Name
    env: HOSTNAME
    default: "A Rust Server"
  - name: Level
    env: LEVEL
    default: "Procedural Map"
  - name: Description
    env: DESCRIPTION
    default: "Powered by Pterodactyl"
  - name: URL
    env: SERVER_URL
    default: "http://pterodactyl.io"
  - name: World Size
    env: WORLD_SIZE
    default: "3000"
  - name: World Seed
    env: WORLD_SEED
    default: "1234"
  - name: Max Players
    env: MAX_PLAYERS
    default: "40"
  - name: Server Image
    env: SERVER_IMG
    default: ""
  - name: RCON Port
    env: RCON_PORT
    default: "28016"
  - name: RCON Password
    env: RCON_PASS
    default: "CHANGEME"
  - name: Save Interval
    env: SAVEINTERVAL
    default: "60"
  - name: Additional Arguments
    env: ADDITIONAL_ARGS
    default: ""
  - name: App Port
    env: APP_PORT
    default: "28082"
  - name: Server Logo
    env: SERVER_LOGO
    default: ""
  - name: Custom Map URL
    env: MAP_URL
    default: ""
  - name: Query Port
    env: QUERY_PORT
    default: "27017"
  - name: Modding Framework
    env: FRAMEWORK
    default: "carbon"
    rules: required|in:vanilla,oxide,oxide-staging,carbon,carbon-minimal,carbon-edge,carbon-edge-minimal,carbon-staging,carbon-staging-minimal,carbon-aux1,carbon-aux1-minimal,carbon-aux2,carbon-aux2-minimal
  - name: Modding Root Directory
    env: MODDING_ROOT
    default: "carbon"
  - name: Server Tags
    env: SERVER_TAGS
    default: "vanilla"
  - name: Server Identity
    env: SERVER_IDENTITY
    default: "rust"
  - name: Auto Update
    env: AUTO_UPDATE
    default: "1"
  - name: Chaos Code Extension
    env: CHAOS_EXT
    default: "0"
  - name: Discord Extension
    env: DISCORD_EXT
    default: "0"
  - name: RustEdit Extension
    env: RUSTEDIT_EXT
    default: "0"
  - name: Validate Game Files
    env: VALIDATE
    default: "1"
  - name: App Public IP
    env: APP_PUBLIC_IP
    default: ""
  - name: Framework Update
    env: FRAMEWORK_UPDATE
    default: "1"
  - name: Gamemode
    env: GAMEMODE
    default: "vanilla"
  - name: Log File Location
    env: LOG_FILE
    default: "rust_log_latest.txt"
  - name: Debug Mode
    env: EGG_DEBUG
    default: "1"
