name: MongoDB
description: MongoDB is a general purpose, document-based, distributed database.
author: parker@parkervcp.com
images:
  - !!var images.mongodb_4

install:
  script: !!file install.sh
  container: "mongo:4-bionic"
  entrypoint: "bash"

config:
  stop: "exit"
  startup:
    done: "child process started successfully"

startup: mongod --fork --dbpath /home/container/mongodb/ --port ${SERVER_PORT} --bind_ip 0.0.0.0 --logpath /home/container/logs/mongo.log; until nc -z -v -w5 127.0.0.1 ${SERVER_PORT}; do echo 'Waiting for mongodb connection...'; sleep 5; done && mongo 127.0.0.1:${SERVER_PORT} && mongo --eval "db.getSiblingDB('admin').shutdownServer()" 127.0.0.1:${SERVER_PORT}

variables:
  - name: Mongo Admin Username
    description: The MongoDB Admin user
    env: MONGO_USER
    default: "admin"
    rules: required|string
  - name: Mongo Admin Password
    env: MONGO_USER_PASS
    default: "aP@55word"
    rules: required|string
