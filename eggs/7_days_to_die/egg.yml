name: 7 Days To Die
description: 7 days to die server
images:
  - !!var images.steamcmd

install:
  script:
    - !!file ../../../scripts/install/debian.sh
    - !!file install.sh
  container: "ghcr.io/parkervcp/installers:debian"
  entrypoint: "bash"

config:
  stop: "shutdown"
  startup:
    done: "Connected with 7DTD server"
  files: {}
  logs: {}

startup: ./7DaysToDieServer.x86_64 -configfile=serverconfig.xml -quit -batchmode -nographics -dedicated -ServerPort=${SERVER_PORT} -ServerDisabledNetworkProtocols=${SERVER_DISABLED_NETWORK_PROTOCOLS} -ServerMaxPlayerCount=${MAX_PLAYERS} -GameDifficulty=${GAME_DIFFICULTY} -ControlPanelEnabled=false -TelnetEnabled=true -TelnetPort=${TELNET_PORT} -TelnetPassword=${PASSWORD} -logfile logs/latest.log & echo -e "Checking on telnet connection" && until nc -z -v -w5 127.0.0.1 ${TELNET_PORT}; do echo "Waiting for telnet connection..."; sleep 5; done && $( [[ -z ${PASSWORD} ]] && printf %s "telnet -E 127.0.0.1 ${TELNET_PORT}" || printf %s "rcon -t telnet -a 127.0.0.1:${TELNET_PORT} -p {{PASSWORD}}" )

variables:
  - name: Max Players
    env: MAX_PLAYERS
    default: "8"
  - name: Game Difficulty
    env: GAME_DIFFICULTY
    default: "2"
  - name: Source AppID
    env: SRCDS_APPID
    default: "294420"
  - name: Auto Update
    env: AUTO_UPDATE
    default: "1"
  - name: Beta Branch
    env: SRCDS_BETAID
    default: ""
  - name: Telnet Password
    env: PASSWORD
    default: ""
  - name: Telnet Port
    env: TELNET_PORT
    default: "8081"
  - name: Network Protocols
    env: SERVER_DISABLED_NETWORK_PROTOCOLS
    default: ""
